{"version":3,"file":"exception-autocapture.js","sources":["../src/utils/globals.ts","../src/utils/type-utils.ts","../src/extensions/exception-autocapture/type-checking.ts","../src/extensions/exception-autocapture/stack-trace.ts","../src/extensions/exception-autocapture/error-conversion.ts","../src/utils/logger.ts","../src/extensions/exception-autocapture/index.ts","../src/loader-exception-autocapture.ts"],"sourcesContent":["/*\n * Saved references to long variable names, so that bundling can minimize file size.\n */\nexport const ArrayProto = Array.prototype\nexport const nativeForEach = ArrayProto.forEach\nexport const nativeIndexOf = ArrayProto.indexOf\n// eslint-disable-next-line no-restricted-globals\nexport const win: (Window & typeof globalThis) | undefined = typeof window !== 'undefined' ? window : undefined\nconst navigator = win?.navigator\nexport const document = win?.document\nexport const userAgent = navigator?.userAgent\nexport const assignableWindow: Window & typeof globalThis & Record<string, any> = win ?? ({} as any)\n\nexport { win as window }\n","// eslint-disable-next-line posthog-js/no-direct-array-check\nconst nativeIsArray = Array.isArray\nconst ObjProto = Object.prototype\nexport const hasOwnProperty = ObjProto.hasOwnProperty\nconst toString = ObjProto.toString\n\nexport const _isArray =\n    nativeIsArray ||\n    function (obj: any): obj is any[] {\n        return toString.call(obj) === '[object Array]'\n    }\nexport const _isUint8Array = function (x: unknown): x is Uint8Array {\n    return toString.call(x) === '[object Uint8Array]'\n}\n// from a comment on http://dbj.org/dbj/?p=286\n// fails on only one very rare and deliberate custom object:\n// let bomb = { toString : undefined, valueOf: function(o) { return \"function BOMBA!\"; }};\nexport const _isFunction = function (f: any): f is (...args: any[]) => any {\n    // eslint-disable-next-line posthog-js/no-direct-function-check\n    return typeof f === 'function'\n}\n// Underscore Addons\nexport const _isObject = function (x: unknown): x is Record<string, any> {\n    // eslint-disable-next-line posthog-js/no-direct-object-check\n    return x === Object(x) && !_isArray(x)\n}\nexport const _isEmptyObject = function (x: unknown): x is Record<string, any> {\n    if (_isObject(x)) {\n        for (const key in x) {\n            if (hasOwnProperty.call(x, key)) {\n                return false\n            }\n        }\n        return true\n    }\n    return false\n}\nexport const _isUndefined = function (x: unknown): x is undefined {\n    return x === void 0\n}\nexport const _isString = function (x: unknown): x is string {\n    // eslint-disable-next-line posthog-js/no-direct-string-check\n    return toString.call(x) == '[object String]'\n}\n\nexport const _isNull = function (x: unknown): x is null {\n    // eslint-disable-next-line posthog-js/no-direct-null-check\n    return x === null\n}\nexport const _isDate = function (x: unknown): x is Date {\n    // eslint-disable-next-line posthog-js/no-direct-date-check\n    return toString.call(x) == '[object Date]'\n}\nexport const _isNumber = function (x: unknown): x is number {\n    // eslint-disable-next-line posthog-js/no-direct-number-check\n    return toString.call(x) == '[object Number]'\n}\nexport const _isBoolean = function (x: unknown): x is boolean {\n    // eslint-disable-next-line posthog-js/no-direct-boolean-check\n    return toString.call(x) === '[object Boolean]'\n}\n","import { _isFunction, _isNull, _isObject, _isUndefined } from '../../utils/type-utils'\n\nexport function isEvent(candidate: unknown): candidate is Event {\n    return !_isUndefined(Event) && isInstanceOf(candidate, Event)\n}\n\nexport function isPlainObject(candidate: unknown): candidate is Record<string, unknown> {\n    return isBuiltin(candidate, 'Object')\n}\n\nexport function isInstanceOf(candidate: unknown, base: any): boolean {\n    try {\n        return candidate instanceof base\n    } catch (_e) {\n        return false\n    }\n}\n\nexport function isPrimitive(\n    candidate: unknown\n): candidate is number | string | boolean | bigint | symbol | null | undefined {\n    return _isNull(candidate) || (!_isObject(candidate) && !_isFunction(candidate))\n}\n\nexport function isError(candidate: unknown): candidate is Error {\n    switch (Object.prototype.toString.call(candidate)) {\n        case '[object Error]':\n        case '[object Exception]':\n        case '[object DOMException]':\n            return true\n        default:\n            return isInstanceOf(candidate, Error)\n    }\n}\n\nexport function isErrorEvent(event: string | Error | Event): event is ErrorEvent {\n    return isBuiltin(event, 'ErrorEvent')\n}\n\nexport function isErrorWithStack(candidate: unknown): candidate is Error {\n    return 'stack' in (candidate as Error)\n}\n\nexport function isBuiltin(candidate: unknown, className: string): boolean {\n    return Object.prototype.toString.call(candidate) === `[object ${className}]`\n}\n\nexport function isDOMException(candidate: unknown): boolean {\n    return isBuiltin(candidate, 'DOMException')\n}\n\nexport function isDOMError(candidate: unknown): boolean {\n    return isBuiltin(candidate, 'DOMError')\n}\n","// copied and adapted from https://github.com/getsentry/sentry-javascript/blob/41fef4b10f3a644179b77985f00f8696c908539f/packages/browser/src/stack-parsers.ts\n// ðŸ’–open source\n\n// This was originally forked from https://github.com/csnover/TraceKit, and was largely\n// re-written as part of raven - js.\n//\n// This code was later copied to the JavaScript mono - repo and further modified and\n// refactored over the years.\n\n// Copyright (c) 2013 Onur Can Cakmak onur.cakmak@gmail.com and all TraceKit contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this\n// software and associated documentation files(the 'Software'), to deal in the Software\n// without restriction, including without limitation the rights to use, copy, modify,\n// merge, publish, distribute, sublicense, and / or sell copies of the Software, and to\n// permit persons to whom the Software is furnished to do so, subject to the following\n// conditions:\n//\n// The above copyright notice and this permission notice shall be included in all copies\n// or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n// INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n// PARTICULAR PURPOSE AND NONINFRINGEMENT.IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF\n// CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE\n// OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nimport { _isUndefined } from '../../utils/type-utils'\n\nconst WEBPACK_ERROR_REGEXP = /\\(error: (.*)\\)/\nconst STACKTRACE_FRAME_LIMIT = 50\n\nconst UNKNOWN_FUNCTION = '?'\n\nconst OPERA10_PRIORITY = 10\nconst OPERA11_PRIORITY = 20\nconst CHROME_PRIORITY = 30\nconst WINJS_PRIORITY = 40\nconst GECKO_PRIORITY = 50\n\nexport interface StackFrame {\n    filename?: string\n    function?: string\n    module?: string\n    platform?: string\n    lineno?: number\n    colno?: number\n    abs_path?: string\n    context_line?: string\n    pre_context?: string[]\n    post_context?: string[]\n    in_app?: boolean\n    instruction_addr?: string\n    addr_mode?: string\n    vars?: { [key: string]: any }\n    debug_id?: string\n}\n\nfunction createFrame(filename: string, func: string, lineno?: number, colno?: number): StackFrame {\n    const frame: StackFrame = {\n        filename,\n        function: func,\n        in_app: true, // All browser frames are considered in_app\n    }\n\n    if (!_isUndefined(lineno)) {\n        frame.lineno = lineno\n    }\n\n    if (!_isUndefined(colno)) {\n        frame.colno = colno\n    }\n\n    return frame\n}\n\nexport type StackParser = (stack: string, skipFirst?: number) => StackFrame[]\nexport type StackLineParserFn = (line: string) => StackFrame | undefined\nexport type StackLineParser = [number, StackLineParserFn]\n\n// Chromium based browsers: Chrome, Brave, new Opera, new Edge\nconst chromeRegex =\n    /^\\s*at (?:(.+?\\)(?: \\[.+\\])?|.*?) ?\\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\\/)?.*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i\nconst chromeEvalRegex = /\\((\\S*)(?::(\\d+))(?::(\\d+))\\)/\n\nconst chrome: StackLineParserFn = (line) => {\n    const parts = chromeRegex.exec(line)\n\n    if (parts) {\n        const isEval = parts[2] && parts[2].indexOf('eval') === 0 // start of line\n\n        if (isEval) {\n            const subMatch = chromeEvalRegex.exec(parts[2])\n\n            if (subMatch) {\n                // throw out eval line/column and use top-most line/column number\n                parts[2] = subMatch[1] // url\n                parts[3] = subMatch[2] // line\n                parts[4] = subMatch[3] // column\n            }\n        }\n\n        // Kamil: One more hack won't hurt us right? Understanding and adding more rules on top of these regexps right now\n        // would be way too time consuming. (TODO: Rewrite whole RegExp to be more readable)\n        const [func, filename] = extractSafariExtensionDetails(parts[1] || UNKNOWN_FUNCTION, parts[2])\n\n        return createFrame(filename, func, parts[3] ? +parts[3] : undefined, parts[4] ? +parts[4] : undefined)\n    }\n\n    return\n}\n\nexport const chromeStackLineParser: StackLineParser = [CHROME_PRIORITY, chrome]\n\n// gecko regex: `(?:bundle|\\d+\\.js)`: `bundle` is for react native, `\\d+\\.js` also but specifically for ram bundles because it\n// generates filenames without a prefix like `file://` the filenames in the stacktrace are just 42.js\n// We need this specific case for now because we want no other regex to match.\nconst geckoREgex =\n    /^\\s*(.*?)(?:\\((.*?)\\))?(?:^|@)?((?:[-a-z]+)?:\\/.*?|\\[native code\\]|[^@]*(?:bundle|\\d+\\.js)|\\/[\\w\\-. /=]+)(?::(\\d+))?(?::(\\d+))?\\s*$/i\nconst geckoEvalRegex = /(\\S+) line (\\d+)(?: > eval line \\d+)* > eval/i\n\nconst gecko: StackLineParserFn = (line) => {\n    const parts = geckoREgex.exec(line)\n\n    if (parts) {\n        const isEval = parts[3] && parts[3].indexOf(' > eval') > -1\n        if (isEval) {\n            const subMatch = geckoEvalRegex.exec(parts[3])\n\n            if (subMatch) {\n                // throw out eval line/column and use top-most line number\n                parts[1] = parts[1] || 'eval'\n                parts[3] = subMatch[1]\n                parts[4] = subMatch[2]\n                parts[5] = '' // no column when eval\n            }\n        }\n\n        let filename = parts[3]\n        let func = parts[1] || UNKNOWN_FUNCTION\n        ;[func, filename] = extractSafariExtensionDetails(func, filename)\n\n        return createFrame(filename, func, parts[4] ? +parts[4] : undefined, parts[5] ? +parts[5] : undefined)\n    }\n\n    return\n}\n\nexport const geckoStackLineParser: StackLineParser = [GECKO_PRIORITY, gecko]\n\nconst winjsRegex = /^\\s*at (?:((?:\\[object object\\])?.+) )?\\(?((?:[-a-z]+):.*?):(\\d+)(?::(\\d+))?\\)?\\s*$/i\n\nconst winjs: StackLineParserFn = (line) => {\n    const parts = winjsRegex.exec(line)\n\n    return parts\n        ? createFrame(parts[2], parts[1] || UNKNOWN_FUNCTION, +parts[3], parts[4] ? +parts[4] : undefined)\n        : undefined\n}\n\nexport const winjsStackLineParser: StackLineParser = [WINJS_PRIORITY, winjs]\n\nconst opera10Regex = / line (\\d+).*script (?:in )?(\\S+)(?:: in function (\\S+))?$/i\n\nconst opera10: StackLineParserFn = (line) => {\n    const parts = opera10Regex.exec(line)\n    return parts ? createFrame(parts[2], parts[3] || UNKNOWN_FUNCTION, +parts[1]) : undefined\n}\n\nexport const opera10StackLineParser: StackLineParser = [OPERA10_PRIORITY, opera10]\n\nconst opera11Regex = / line (\\d+), column (\\d+)\\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\\(.*\\))? in (.*):\\s*$/i\n\nconst opera11: StackLineParserFn = (line) => {\n    const parts = opera11Regex.exec(line)\n    return parts ? createFrame(parts[5], parts[3] || parts[4] || UNKNOWN_FUNCTION, +parts[1], +parts[2]) : undefined\n}\n\nexport const opera11StackLineParser: StackLineParser = [OPERA11_PRIORITY, opera11]\n\nexport const defaultStackLineParsers = [chromeStackLineParser, geckoStackLineParser, winjsStackLineParser]\n\nexport function reverse(stack: ReadonlyArray<StackFrame>): StackFrame[] {\n    if (!stack.length) {\n        return []\n    }\n\n    const localStack = stack.slice(0, STACKTRACE_FRAME_LIMIT)\n\n    localStack.reverse()\n\n    return localStack.map((frame) => ({\n        ...frame,\n        filename: frame.filename || localStack[localStack.length - 1].filename,\n        function: frame.function || '?',\n    }))\n}\n\nexport function createStackParser(...parsers: StackLineParser[]): StackParser {\n    const sortedParsers = parsers.sort((a, b) => a[0] - b[0]).map((p) => p[1])\n\n    return (stack: string, skipFirst = 0): StackFrame[] => {\n        const frames: StackFrame[] = []\n        const lines = stack.split('\\n')\n\n        for (let i = skipFirst; i < lines.length; i++) {\n            const line = lines[i]\n            // Ignore lines over 1kb as they are unlikely to be stack frames.\n            // Many of the regular expressions use backtracking which results in run time that increases exponentially with\n            // input size. Huge strings can result in hangs/Denial of Service:\n            // https://github.com/getsentry/sentry-javascript/issues/2286\n            if (line.length > 1024) {\n                continue\n            }\n\n            // https://github.com/getsentry/sentry-javascript/issues/5459\n            // Remove webpack (error: *) wrappers\n            const cleanedLine = WEBPACK_ERROR_REGEXP.test(line) ? line.replace(WEBPACK_ERROR_REGEXP, '$1') : line\n\n            // https://github.com/getsentry/sentry-javascript/issues/7813\n            // Skip Error: lines\n            if (cleanedLine.match(/\\S*Error: /)) {\n                continue\n            }\n\n            for (const parser of sortedParsers) {\n                const frame = parser(cleanedLine)\n\n                if (frame) {\n                    frames.push(frame)\n                    break\n                }\n            }\n\n            if (frames.length >= STACKTRACE_FRAME_LIMIT) {\n                break\n            }\n        }\n\n        return reverse(frames)\n    }\n}\n\nexport const defaultStackParser = createStackParser(...defaultStackLineParsers)\n\n/**\n * Safari web extensions, starting version unknown, can produce \"frames-only\" stacktraces.\n * What it means, is that instead of format like:\n *\n * Error: wat\n *   at function@url:row:col\n *   at function@url:row:col\n *   at function@url:row:col\n *\n * it produces something like:\n *\n *   function@url:row:col\n *   function@url:row:col\n *   function@url:row:col\n *\n * Because of that, it won't be captured by `chrome` RegExp and will fall into `Gecko` branch.\n * This function is extracted so that we can use it in both places without duplicating the logic.\n * Unfortunately \"just\" changing RegExp is too complicated now and making it pass all tests\n * and fix this case seems like an impossible, or at least way too time-consuming task.\n */\nconst extractSafariExtensionDetails = (func: string, filename: string): [string, string] => {\n    const isSafariExtension = func.indexOf('safari-extension') !== -1\n    const isSafariWebExtension = func.indexOf('safari-web-extension') !== -1\n\n    return isSafariExtension || isSafariWebExtension\n        ? [\n              func.indexOf('@') !== -1 ? func.split('@')[0] : UNKNOWN_FUNCTION,\n              isSafariExtension ? `safari-extension:${filename}` : `safari-web-extension:${filename}`,\n          ]\n        : [func, filename]\n}\n","import {\n    isDOMError,\n    isDOMException,\n    isError,\n    isErrorEvent,\n    isErrorWithStack,\n    isEvent,\n    isPlainObject,\n    isPrimitive,\n} from './type-checking'\nimport { defaultStackParser, StackFrame } from './stack-trace'\n\nimport { _isNumber, _isString, _isUndefined } from '../../utils/type-utils'\n\n/**\n * based on the very wonderful MIT licensed Sentry SDK\n */\n\nconst ERROR_TYPES_PATTERN =\n    /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i\n\nexport type ErrorEventArgs = [\n    event: string | Event,\n    source?: string | undefined,\n    lineno?: number | undefined,\n    colno?: number | undefined,\n    error?: Error | undefined\n]\n\nexport interface ErrorProperties {\n    $exception_type: string\n    $exception_message: string\n    $exception_source?: string\n    $exception_lineno?: number\n    $exception_colno?: number\n    $exception_DOMException_code?: string\n    $exception_is_synthetic?: boolean\n    $exception_stack_trace_raw?: string\n    $exception_handled?: boolean\n    $exception_personURL?: string\n}\n\nconst reactMinifiedRegexp = /Minified React error #\\d+;/i\n\nfunction getPopSize(ex: Error & { framesToPop?: number }): number {\n    if (ex) {\n        if (_isNumber(ex.framesToPop)) {\n            return ex.framesToPop\n        }\n\n        if (reactMinifiedRegexp.test(ex.message)) {\n            return 1\n        }\n    }\n\n    return 0\n}\n\nexport function parseStackFrames(ex: Error & { framesToPop?: number; stacktrace?: string }): StackFrame[] {\n    // Access and store the stacktrace property before doing ANYTHING\n    // else to it because Opera is not very good at providing it\n    // reliably in other circumstances.\n    const stacktrace = ex.stacktrace || ex.stack || ''\n\n    const popSize = getPopSize(ex)\n\n    try {\n        return defaultStackParser(stacktrace, popSize)\n    } catch (e) {\n        // no-empty\n    }\n\n    return []\n}\n\nfunction errorPropertiesFromError(error: Error): ErrorProperties {\n    const frames = parseStackFrames(error)\n\n    return {\n        $exception_type: error.name,\n        $exception_message: error.message,\n        $exception_stack_trace_raw: JSON.stringify(frames),\n    }\n}\n\nfunction errorPropertiesFromString(candidate: string): ErrorProperties {\n    return {\n        $exception_type: 'Error',\n        $exception_message: candidate,\n    }\n}\n\n/**\n * Given any captured exception, extract its keys and create a sorted\n * and truncated list that will be used inside the event message.\n * eg. `Non-error exception captured with keys: foo, bar, baz`\n */\nfunction extractExceptionKeysForMessage(exception: Record<string, unknown>, maxLength = 40): string {\n    const keys = Object.keys(exception)\n    keys.sort()\n\n    if (!keys.length) {\n        return '[object has no keys]'\n    }\n\n    for (let i = keys.length; i > 0; i--) {\n        const serialized = keys.slice(0, i).join(', ')\n        if (serialized.length > maxLength) {\n            continue\n        }\n        if (i === keys.length) {\n            return serialized\n        }\n        return serialized.length <= maxLength ? serialized : `${serialized.slice(0, maxLength)}...`\n    }\n\n    return ''\n}\n\nfunction errorPropertiesFromObject(candidate: Record<string, unknown>): ErrorProperties {\n    return {\n        $exception_type: isEvent(candidate) ? candidate.constructor.name : 'Error',\n        $exception_message: `Non-Error ${'exception'} captured with keys: ${extractExceptionKeysForMessage(candidate)}`,\n    }\n}\n\nexport function errorToProperties([event, source, lineno, colno, error]: ErrorEventArgs): ErrorProperties {\n    // exception type and message are not optional but, it's useful to start off without them enforced\n    let errorProperties: Omit<ErrorProperties, '$exception_type' | '$exception_message'> & {\n        $exception_type?: string\n        $exception_message?: string\n    } = {}\n\n    if (_isUndefined(error) && _isString(event)) {\n        let name = 'Error'\n        let message = event\n        const groups = event.match(ERROR_TYPES_PATTERN)\n        if (groups) {\n            name = groups[1]\n            message = groups[2]\n        }\n        errorProperties = {\n            $exception_type: name,\n            $exception_message: message,\n        }\n    }\n\n    const candidate = error || event\n\n    if (isDOMError(candidate) || isDOMException(candidate)) {\n        // https://developer.mozilla.org/en-US/docs/Web/API/DOMError\n        // https://developer.mozilla.org/en-US/docs/Web/API/DOMException\n\n        const domException = candidate as unknown as DOMException\n\n        if (isErrorWithStack(candidate)) {\n            errorProperties = errorPropertiesFromError(candidate as Error)\n        } else {\n            const name = domException.name || (isDOMError(domException) ? 'DOMError' : 'DOMException')\n            const message = domException.message ? `${name}: ${domException.message}` : name\n            errorProperties = errorPropertiesFromString(message)\n            errorProperties.$exception_type = isDOMError(domException) ? 'DOMError' : 'DOMException'\n            errorProperties.$exception_message = errorProperties.$exception_message || message\n        }\n        if ('code' in domException) {\n            errorProperties['$exception_DOMException_code'] = `${domException.code}`\n        }\n    } else if (isErrorEvent(candidate as ErrorEvent) && (candidate as ErrorEvent).error) {\n        errorProperties = errorPropertiesFromError((candidate as ErrorEvent).error as Error)\n    } else if (isError(candidate)) {\n        errorProperties = errorPropertiesFromError(candidate)\n    } else if (isPlainObject(candidate) || isEvent(candidate)) {\n        // group these by using the keys available on the object\n        const objectException = candidate as Record<string, unknown>\n        errorProperties = errorPropertiesFromObject(objectException)\n        errorProperties.$exception_is_synthetic = true\n    } else {\n        // If none of previous checks were valid, then it must be a string\n        errorProperties.$exception_type = errorProperties.$exception_type || 'Error'\n        errorProperties.$exception_message = errorProperties.$exception_message || candidate\n        errorProperties.$exception_is_synthetic = true\n    }\n\n    return {\n        ...errorProperties,\n        // now we make sure the mandatory fields that were made optional are present\n        $exception_type: errorProperties.$exception_type || 'UnknownErrorType',\n        $exception_message: errorProperties.$exception_message || '',\n        ...(source\n            ? {\n                  $exception_source: source, // TODO get this from URL if not present\n              }\n            : {}),\n        ...(lineno ? { $exception_lineno: lineno } : {}),\n        ...(colno ? { $exception_colno: colno } : {}),\n    }\n}\n\nexport function unhandledRejectionToProperties([ev]: [ev: PromiseRejectionEvent]): ErrorProperties {\n    // dig the object of the rejection out of known event types\n    let error: unknown = ev\n    try {\n        // PromiseRejectionEvents store the object of the rejection under 'reason'\n        // see https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent\n        if ('reason' in ev) {\n            error = ev.reason\n        }\n        // something, somewhere, (likely a browser extension) effectively casts PromiseRejectionEvents\n        // to CustomEvents, moving the `promise` and `reason` attributes of the PRE into\n        // the CustomEvent's `detail` attribute, since they're not part of CustomEvent's spec\n        // see https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent and\n        // https://github.com/getsentry/sentry-javascript/issues/2380\n        else if ('detail' in ev && 'reason' in (ev as any).detail) {\n            error = (ev as any).detail.reason\n        }\n    } catch (_oO) {\n        // no-empty\n    }\n\n    // exception type and message are not optional but, it's useful to start off without them enforced\n    let errorProperties: Omit<ErrorProperties, '$exception_type' | '$exception_message'> & {\n        $exception_type?: string\n        $exception_message?: string\n    } = {}\n    if (isPrimitive(error)) {\n        errorProperties = {\n            $exception_message: `Non-Error promise rejection captured with value: ${String(error)}`,\n        }\n    } else {\n        errorProperties = errorToProperties([error as string | Event])\n    }\n    errorProperties.$exception_handled = false\n\n    return {\n        ...errorProperties,\n        // now we make sure the mandatory fields that were made optional are present\n        $exception_type: (errorProperties.$exception_type = 'UnhandledRejection'),\n        $exception_message: (errorProperties.$exception_message =\n            errorProperties.$exception_message || (ev as any).reason || String(error)),\n    }\n}\n","import Config from '../config'\nimport { _isUndefined } from './type-utils'\nimport { assignableWindow, window } from './globals'\n\nconst LOGGER_PREFIX = '[PostHog.js]'\nexport const logger = {\n    _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => {\n        if (\n            window &&\n            (Config.DEBUG || assignableWindow.POSTHOG_DEBUG) &&\n            !_isUndefined(window.console) &&\n            window.console\n        ) {\n            const consoleLog =\n                '__rrweb_original__' in window.console[level]\n                    ? (window.console[level] as any)['__rrweb_original__']\n                    : window.console[level]\n\n            // eslint-disable-next-line no-console\n            consoleLog(LOGGER_PREFIX, ...args)\n        }\n    },\n\n    info: (...args: any[]) => {\n        logger._log('log', ...args)\n    },\n\n    warn: (...args: any[]) => {\n        logger._log('warn', ...args)\n    },\n\n    error: (...args: any[]) => {\n        logger._log('error', ...args)\n    },\n\n    critical: (...args: any[]) => {\n        // Critical errors are always logged to the console\n        // eslint-disable-next-line no-console\n        console.error(LOGGER_PREFIX, ...args)\n    },\n\n    uninitializedWarning: (methodName: string) => {\n        logger.error(`You must initialize PostHog before calling ${methodName}`)\n    },\n}\n","import { window } from '../../utils/globals'\nimport { PostHog } from '../../posthog-core'\nimport { DecideResponse, Properties } from '../../types'\nimport { ErrorEventArgs, ErrorProperties, errorToProperties, unhandledRejectionToProperties } from './error-conversion'\nimport { isPrimitive } from './type-checking'\n\nimport { _isArray, _isObject, _isUndefined } from '../../utils/type-utils'\nimport { logger } from '../../utils/logger'\n\nconst EXCEPTION_INGESTION_ENDPOINT = '/e/'\n\nexport const extendPostHog = (instance: PostHog, response: DecideResponse) => {\n    const exceptionObserver = new ExceptionObserver(instance)\n    exceptionObserver.afterDecideResponse(response)\n    return exceptionObserver\n}\n\nexport class ExceptionObserver {\n    instance: PostHog\n    remoteEnabled: boolean | undefined\n    private originalOnErrorHandler: Window['onerror'] | null | undefined = undefined\n    private originalOnUnhandledRejectionHandler: Window['onunhandledrejection'] | null | undefined = undefined\n\n    private errorsToIgnore: RegExp[] = []\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n    }\n\n    startCapturing() {\n        if (!window || !this.isEnabled() || (window.onerror as any)?.__POSTHOG_INSTRUMENTED__) {\n            return\n        }\n\n        try {\n            this.originalOnErrorHandler = window.onerror\n\n            window.onerror = function (this: ExceptionObserver, ...args: ErrorEventArgs): boolean {\n                this.captureException(args)\n\n                if (this.originalOnErrorHandler) {\n                    // eslint-disable-next-line prefer-rest-params\n                    return this.originalOnErrorHandler.apply(this, args)\n                }\n\n                return false\n            }.bind(this)\n            ;(window.onerror as any).__POSTHOG_INSTRUMENTED__ = true\n\n            this.originalOnUnhandledRejectionHandler = window.onunhandledrejection\n\n            window.onunhandledrejection = function (\n                this: ExceptionObserver,\n                ...args: [ev: PromiseRejectionEvent]\n            ): boolean {\n                const errorProperties: ErrorProperties = unhandledRejectionToProperties(args)\n                this.sendExceptionEvent(errorProperties)\n\n                if (window && this.originalOnUnhandledRejectionHandler) {\n                    // eslint-disable-next-line prefer-rest-params\n                    return this.originalOnUnhandledRejectionHandler.apply(window, args)\n                }\n\n                return true\n            }.bind(this)\n            ;(window.onunhandledrejection as any).__POSTHOG_INSTRUMENTED__ = true\n        } catch (e) {\n            logger.error('PostHog failed to start exception autocapture', e)\n            this.stopCapturing()\n        }\n    }\n\n    stopCapturing() {\n        if (!window) {\n            return\n        }\n        if (!_isUndefined(this.originalOnErrorHandler)) {\n            window.onerror = this.originalOnErrorHandler\n            this.originalOnErrorHandler = null\n        }\n        delete (window.onerror as any)?.__POSTHOG_INSTRUMENTED__\n\n        if (!_isUndefined(this.originalOnUnhandledRejectionHandler)) {\n            window.onunhandledrejection = this.originalOnUnhandledRejectionHandler\n            this.originalOnUnhandledRejectionHandler = null\n        }\n        delete (window.onunhandledrejection as any)?.__POSTHOG_INSTRUMENTED__\n    }\n\n    isCapturing() {\n        return !!(window?.onerror as any)?.__POSTHOG_INSTRUMENTED__\n    }\n\n    isEnabled() {\n        return this.remoteEnabled ?? false\n    }\n\n    afterDecideResponse(response: DecideResponse) {\n        const autocaptureExceptionsResponse = response.autocaptureExceptions\n        this.remoteEnabled = !!autocaptureExceptionsResponse || false\n        if (\n            !isPrimitive(autocaptureExceptionsResponse) &&\n            'errors_to_ignore' in autocaptureExceptionsResponse &&\n            _isArray(autocaptureExceptionsResponse.errors_to_ignore)\n        ) {\n            const dropRules = autocaptureExceptionsResponse.errors_to_ignore\n\n            this.errorsToIgnore = dropRules.map((rule) => {\n                return new RegExp(rule)\n            })\n        }\n\n        if (this.isEnabled()) {\n            this.startCapturing()\n            logger.info(\n                '[Exception Capture] Remote config for exception autocapture is enabled, starting with config: ',\n                _isObject(autocaptureExceptionsResponse) ? autocaptureExceptionsResponse : {}\n            )\n        }\n    }\n\n    captureException(args: ErrorEventArgs, properties?: Properties) {\n        const errorProperties = errorToProperties(args)\n\n        if (this.errorsToIgnore.some((regex) => regex.test(errorProperties.$exception_message || ''))) {\n            logger.info('[Exception Capture] Ignoring exception based on remote config', errorProperties)\n            return\n        }\n\n        const propertiesToSend = { ...properties, ...errorProperties }\n\n        const posthogHost = this.instance.config.ui_host || this.instance.config.api_host\n        errorProperties.$exception_personURL = posthogHost + '/person/' + this.instance.get_distinct_id()\n\n        this.sendExceptionEvent(propertiesToSend)\n    }\n\n    /**\n     * :TRICKY: Make sure we batch these requests\n     */\n    sendExceptionEvent(properties: { [key: string]: any }) {\n        this.instance.capture('$exception', properties, {\n            transport: 'XHR',\n            method: 'POST',\n            endpoint: EXCEPTION_INGESTION_ENDPOINT,\n            _noTruncate: true,\n            _batchKey: 'exceptionEvent',\n        })\n    }\n}\n","import { extendPostHog } from './extensions/exception-autocapture'\n\nimport { window } from './utils/globals'\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nwindow.extendPostHogWithExceptionAutoCapture = extendPostHog\n\nexport default extendPostHog\n"],"names":["win","window","undefined","navigator","document","userAgent","assignableWindow","nativeIsArray","Array","isArray","toString","Object","prototype","_isArray","obj","call","_isFunction","f","_isObject","x","_isUndefined","_isString","_isNull","_isNumber","isEvent","candidate","Event","isInstanceOf","base","_e","isPrimitive","isBuiltin","className","isDOMError","WEBPACK_ERROR_REGEXP","STACKTRACE_FRAME_LIMIT","UNKNOWN_FUNCTION","createFrame","filename","func","lineno","colno","frame","function","in_app","chromeRegex","chromeEvalRegex","geckoREgex","geckoEvalRegex","winjsRegex","defaultStackParser","_len","arguments","length","parsers","_key","sortedParsers","sort","a","b","map","p","stack","skipFirst","frames","lines","split","i","line","cleanedLine","test","replace","match","_step","_iterator","_createForOfIteratorHelper","s","n","done","parser","value","push","err","e","localStack","slice","reverse","_objectSpread","apply","parts","exec","indexOf","subMatch","_extractSafariExtensi2","_slicedToArray","extractSafariExtensionDetails","_extractSafariExtensi4","isSafariExtension","isSafariWebExtension","ERROR_TYPES_PATTERN","reactMinifiedRegexp","parseStackFrames","ex","stacktrace","popSize","framesToPop","message","getPopSize","errorPropertiesFromError","error","$exception_type","name","$exception_message","$exception_stack_trace_raw","JSON","stringify","extractExceptionKeysForMessage","exception","maxLength","keys","serialized","join","concat","errorToProperties","_ref","_ref2","event","source","errorProperties","groups","isDOMException","domException","isErrorWithStack","errorPropertiesFromString","code","isErrorEvent","Error","isError","isPlainObject","constructor","errorPropertiesFromObject","$exception_is_synthetic","$exception_source","$exception_lineno","$exception_colno","LOGGER_PREFIX","logger","_log","level","console","consoleLog","args","info","_len2","_key2","warn","_len3","_key3","_len4","_key4","critical","_console","_len5","_key5","uninitializedWarning","methodName","extendPostHog","instance","response","exceptionObserver","ExceptionObserver","afterDecideResponse","_classCallCheck","this","_defineProperty","key","_window$onerror","isEnabled","onerror","__POSTHOG_INSTRUMENTED__","originalOnErrorHandler","captureException","bind","originalOnUnhandledRejectionHandler","onunhandledrejection","_ref3","ev","reason","detail","_oO","String","$exception_handled","unhandledRejectionToProperties","sendExceptionEvent","stopCapturing","_window$onerror2","_window$onunhandledre","_window$onerror3","_this$remoteEnabled","remoteEnabled","autocaptureExceptionsResponse","autocaptureExceptions","errors_to_ignore","dropRules","errorsToIgnore","rule","RegExp","startCapturing","properties","some","regex","propertiesToSend","posthogHost","config","ui_host","api_host","$exception_personURL","get_distinct_id","capture","transport","method","endpoint","_noTruncate","_batchKey","extendPostHogWithExceptionAutoCapture"],"mappings":"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"}